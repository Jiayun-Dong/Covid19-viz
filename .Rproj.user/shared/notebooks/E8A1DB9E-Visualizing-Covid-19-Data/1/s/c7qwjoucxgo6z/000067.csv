"0","df_test = df_current %>%"
"0","  mutate(pos_rate = positive / totalTestResults) %>%"
"0","  select(state, positive, totalTestResults, pos_rate, test_per_million_pop) %>%"
"0","  filter(positive >= 100) %>%"
"0","  arrange(desc(positive))"
"0",""
"0","# compute national average positive rate and tests per million population"
"0","national_avg = df_current %>% "
"0","  ungroup() %>%"
"0","  summarise(avg_positive_rate = sum(positive, na.rm = TRUE) / sum(totalTestResults, na.rm = TRUE),"
"0","            avg_test_per_million_pop = round(sum(totalTestResults, na.rm = TRUE) / sum(population, na.rm = TRUE) * 1000000)) %>%"
"0","  unlist()"
"0",""
"0",""
"0","title = paste0(""Cross-State Comparison \nNational Average: Positive Rate: "", "
"0","               round(national_avg[1] * 1000) / 10, "
"0","               ""%; Tests per Million Population: "", "
"0","               round(national_avg[2]))"
"0",""
"0","# color the top 10 states in red"
"0","state_list = df_current %>% arrange(desc(positive)) %>% pull(state) "
"0","state_list = state_list[1:10]"
"0",""
"0","ggplot(data = df_test %>% filter(!state %in% state_list), aes(x = test_per_million_pop, y = pos_rate, label = state)) +"
"0","  geom_text(cex = 2.5, color = ""black"") +"
"0","  geom_text(data = df_test %>% filter(state %in% state_list), cex = 2.5, color = ""red"") +"
"0","  geom_hline(yintercept = national_avg[1], linetype=""dashed"", color = ""grey"") +"
"0","  geom_vline(xintercept = national_avg[2], linetype=""dashed"", color = ""grey"") +"
"0","  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +"
"0","  scale_x_continuous(labels = scales::comma) +"
"0","  xlab(""Tests per million population"") + ylab(""Positive rate"") + ggtitle(title) +"
"0","  theme_minimal() + theme(legend.position = ""right"", panel.grid.major = element_blank(), panel.grid.minor = element_blank())"
