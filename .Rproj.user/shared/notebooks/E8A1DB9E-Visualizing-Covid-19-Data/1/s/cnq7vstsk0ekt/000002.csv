"0",""
"0","plot_state = function(state_name){"
"0","  df_trajectoy_state = df_trajectory %>% "
"0","    filter(state == state_name) %>%"
"0","    mutate(positiveDailyIncrease = positive - lag(positive),"
"0","           positiveDailyIncrease = "
"0","             if_else(is.na(positiveDailyIncrease), 0, as.double(positiveDailyIncrease)),  # the first day has no increament"
"0","           positiveRate = positive / totalTestResults)"
"0","  "
"0","  # ""projection"" assuming constant growth rate between date T-3 and T-7"
"0","  xmax = max(df_trajectoy_state$day)"
"0","  ymax = max(df_trajectoy_state$positive)"
"0","  y = df_trajectoy_state$positive[(xmax - 7) : (xmax - 3)]"
"0","  x = df_trajectoy_state$day[(xmax - 7) : (xmax - 3)]"
"0","  f = lm(log(y) ~ x)$coefficients    # constant growth assumption means that log(total cases) is linear in date. Fit that function"
"0","  l = function(x) exp(f[1] + f[2] * x)"
"0","  projection <- data.frame(x = (xmax - 7) : xmax, y = NA)"
"0","  projection$y <- l(projection$x)"
"0","  "
"0","  # time series of positive cases "
"0","  ggplot(data = df_trajectoy_state, aes(x = day)) +"
"0","    geom_line(aes(y = positive, color = ""Positive Cases"")) +"
"0","    geom_bar(stat = ""identity"", aes(y = positiveDailyIncrease, fill = ""Daily Increase in Positive Cases"")) +"
"0","    geom_line(data = projection, aes(x = x, y = y, color = ""Constant Growth""), linetype = ""dashed"") +"
"0","    geom_line(aes(y = positiveRate * ymax, color = ""Positive Rate"")) +"
"0","    scale_y_continuous(labels = scales::comma, "
"0","                       sec.axis = sec_axis(~. / ymax, name = ""Positive Rate"", "
"0","                                           breaks = seq(0,1,length.out = 6),"
"0","                                           labels = c(""0%"", ""20%"", ""40%"", ""60%"", ""80%"", ""100%""))) +"
"0","    scale_x_continuous(breaks = seq(0, xmax, 5), labels = (df_trajectoy_state$date)[1 + seq(0, xmax, 5)]) +"
"0","    scale_color_manual(values = c(""grey"", ""darkred"", ""red"")) +"
"0","    scale_fill_manual(values = c(""darkblue"")) +"
"0","    xlab(""Days since cases reached 100"") + ylab(""Number of Positive Cases"") +"
"0","    theme_minimal() +"
"0","    theme(legend.position = ""bottom"", legend.title = element_blank(), "
"0","          panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +"
"0","    ggtitle(paste0(""Spread of Covid-19 in "", state_name))"
"0","}"
"0",""
