"0",""
"0","plot_state = function(state_name){"
"0","  df_trajectoy_state = df_trajectory %>% "
"0","    filter(state == state_name) %>%"
"0","    mutate(deathDailyIncrease = death - lag(death),"
"0","           deathDailyIncrease = if_else(is.na(deathDailyIncrease), 0, as.double(deathDailyIncrease)),"
"0","           deathRate = death / positive)"
"0","  "
"0","  # projection assuming same growth rate"
"0","  xmax = max(df_trajectoy_state$day)"
"0","  ymax = max(df_trajectoy_state$death)"
"0","  y = df_trajectoy_state$death[(xmax - 7) : (xmax - 3)]"
"0","  x = df_trajectoy_state$day[(xmax - 7) : (xmax - 3)]"
"0","  f = lm(log(y) ~ x)$coefficients"
"0","  l = function(x) exp(f[1] + f[2] * x)"
"0","  projection <- data.frame(x = (xmax - 7) : xmax, y = NA)"
"0","  projection$y <- l(projection$x)"
"0","  "
"0","  str = paste0(""Average growth rate 3~7 days ago: "", round((exp(f[2]) - 1) * 100), ""%"")"
"0","  "
"0","  # time series of positive cases "
"0","  ggplot(data = df_trajectoy_state, aes(x = day)) +"
"0","    geom_line(aes(y = death, color = ""Deaths"")) +"
"0","    geom_bar(stat = ""identity"", aes(y = deathDailyIncrease, fill = ""Daily Increase in Deaths"")) +"
"0","    geom_line(data = projection, aes(x = x, y = y, color = ""Constant Growth""), linetype = ""dashed"") +"
"0","    scale_y_continuous(labels = scales::comma) +"
"0","    scale_x_continuous(breaks = seq(0, xmax, 7), labels = (df_trajectoy_state$date)[1 + seq(0, xmax, 7)]) +"
"0","    scale_color_manual(values = c(""grey"",""darkred"")) +"
"0","    scale_fill_manual(values = c(""darkblue"")) +"
"0","    xlab(""Date"") + "
"0","    ylab(""Number of Deaths"") +"
"0","    theme_minimal() +"
"0","    theme(legend.position = ""bottom"", legend.title = element_blank(), "
"0","          panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +"
"0","    ggtitle(paste0(""Spread of Covid-19 in "", state_name, "": Deaths\n"", str))"
"0","}"
"0",""
